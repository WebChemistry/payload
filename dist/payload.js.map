{"version":3,"file":"payload.js","sources":["../assets/payload.js"],"sourcesContent":["class PayloadResponse {\n\n\t/** @param {Number} */\n\t#code;\n\n\t/** @param {Array} */\n\t#meta;\n\n\t/** @param {Array} */\n\t#data;\n\n\t/** @param {Array} */\n\t#errors;\n\n\t#clientErrorProcessors;\n\n\t/** @var {PayloadExtension[]} */\n\t#extensions;\n\n\t/**\n\t * @param {PayloadExtension[]} extensions\n\t */\n\tconstructor(response, clientErrorProcessors, extensions) {\n\t\tthis.#clientErrorProcessors = clientErrorProcessors;\n\t\tthis.#extensions = extensions;\n\n\t\tif (typeof response !== 'object' || response === null) {\n\t\t\tthrow new Error('Response must be an object.');\n\t\t}\n\n\t\tif (typeof response.code !== 'number') {\n\t\t\tthrow new Error('Response code must be an number.');\n\t\t}\n\n\t\tthis.#code = response.code;\n\n\t\tif (!Array.isArray(response.meta)) {\n\t\t\tthrow new Error('Response meta must be an array.');\n\t\t}\n\n\t\tthis.#meta = response.meta;\n\n\t\tif (!Array.isArray(response.data)) {\n\t\t\tthrow new Error('Response data must be an array.');\n\t\t}\n\n\t\tthis.#data = response.data;\n\n\t\tif (!Array.isArray(response.errors)) {\n\t\t\tthrow new Error('Response errors must be an array.');\n\t\t}\n\n\t\tthis.#errors = response.errors.map(error => {\n\t\t\tif (typeof error.message !== 'string') {\n\t\t\t\tthrow new Error('Response error message must be a string.');\n\t\t\t}\n\n\t\t\tif (typeof error.type !== 'string') {\n\t\t\t\tthrow new Error('Response error type must be a string.');\n\t\t\t}\n\n\t\t\treturn error;\n\t\t});\n\n\t\tthis.#extensions.forEach(extension => extension.before(this));\n\n\t\tthis.#process();\n\n\t\tthis.#extensions.forEach(extension => extension.after(this));\n\t}\n\n\t#process() {\n\t\tthis.getCriticalErrors().forEach(error => {\n\t\t\tconsole.error(error.message)\n\t\t});\n\n\t\tthis.#clientErrorProcessors.forEach(processor => {\n\t\t\tthis.getClientErrors().forEach(error => {\n\t\t\t\tprocessor(error);\n\t\t\t})\n\t\t});\n\t}\n\n\tisSuccess() {\n\t\treturn this.#code >= 200 && this.#code < 300;\n\t}\n\n\tisError() {\n\t\treturn !this.isSuccess();\n\t}\n\n\thasErrors() {\n\t\treturn this.#errors.length !== 0;\n\t}\n\n\thasMeta(key) {\n\t\treturn typeof this.#meta[key] !== 'undefined';\n\t}\n\n\tgetMeta(key) {\n\t\treturn this.#meta[key];\n\t}\n\n\tgetData() {\n\t\treturn this.#data;\n\t}\n\n\tgetCode() {\n\t\treturn this.#code;\n\t}\n\n\tgetClientErrors() {\n\t\treturn this.#errors.filter(error => error.type === 'client');\n\t}\n\n\tgetErrors() {\n\t\treturn this.#errors;\n\t}\n\n\t/**\n\t * @returns {Array}\n\t */\n\tgetCriticalErrors() {\n\t\treturn this.#errors.filter(error => error.type === 'critical');\n\t}\n\n}\n\nclass PayloadExtension {\n\n\t/**\n\t * @param {PayloadResponse} payload\n\t */\n\tbefore(payload) {\n\n\t}\n\n\t/**\n\t * @param {PayloadResponse} payload\n\t */\n\tafter(payload) {\n\n\t}\n\n}\n\nexport default class PayloadResponseFactory {\n\n\t#clientErrorProcessors = [];\n\n\t/** @var {PayloadExtension[]} */\n\t#extensions = [];\n\n\t/**\n\t * @param {PayloadExtension} extension\n\t */\n\taddExtension(extension) {\n\t\tthis.#extensions.push(extension);\n\t}\n\n\taddClientErrorProcessor(processor) {\n\t\tthis.#clientErrorProcessors.push(processor);\n\t}\n\n\t/**\n\t * @param {Promise<Response>} fetch\n\t * @return {Promise<PayloadResponse>}\n\t */\n\tasync createFetch(fetch) {\n\t\treturn new PayloadResponse(\n\t\t\tawait (await fetch).json(),\n\t\t\tthis.#clientErrorProcessors,\n\t\t\tthis.#extensions,\n\t\t);\n\t}\n\n}\n"],"names":[],"mappings":"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"}